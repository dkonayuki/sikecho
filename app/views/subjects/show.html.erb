<!-- sidebar -->
<div class="hidden-xs col-md-2 col-sm-2 sidebar-offcanvas" role="navigation">
	<div class="fixed-menu">
		<div class="show-subject-menu" role="complementary" id="show-subject-overview">
			<h4>要旨</h4>
			<ul class="nav">
	      <li><a href="#description">概要</a></li>
	      <li><a href="#syllabus">シラバス</a></li>
	      <li><a href="#notes">ノート</a></li>         
	    </ul>
		</div>
		
		<% if user_signed_in? %>
		<div class="show-subject-menu" role="complementary" id="show-subject-schedule">
			<%= render 'schedule_menu' %>
		</div>
		
		<div class="show-subject-menu" role="complementary" id="show-subject-notes">
			<h4>ノート</h4>
			<ul class="nav">     
	      <%= link_to new_note_path(subject_id: @subject.id), class: 'btn btn-orange' do %>  
	      <span class="glyphicon glyphicon-plus-sign"></span>追加
	      <% end %>      
	    </ul>
		</div>
		<% end %>
		
	</div>
</div>

<!-- main part -->
<div id="show-subject" class="col-sm-10 col-xs-12">
	<ul id="year-list" class="clear">
		<li class="dropdown year-item">
			<a data-toggle="dropdown" class="btn btn-navi btn-sm dropdown-toggle"><span class="glyphicon glyphicon-cog"></span></a>
			<ul class="dropdown-menu pull-right">
				<li><%= link_to '最新', @subject %></li>
				<% @subject.versions.reverse.first(5).each do |version| %>
					<li>
						<%= link_to version_subject_path(id: @subject.id, version_id: version.id) do %>
			        <%= version.created_at.to_date %>
							<%= version.created_at.strftime("%I:%M%p") %>
						<% end %>
					</li>
				<% end %>
			</ul>
		</li>
		<% @same_subjects.each do |subject| %>
			<% if subject.year == @subject.year %>
				<li class="year-item"><span class="btn btn-white btn-sm active"><%= subject.year %></span></li>
			<% else %>
				<li class="year-item"><%= link_to subject.year, subject, class: "btn btn-navi btn-sm" %></li>
			<% end %>
		<% end %>
	</ul>
  <!--for overview section -->
	<a name="description"></a>
	<div class="skc-box skc-box-no-padding skc-box-lg" id="show-subject-desc">
		<div class="skc-box-content">
			<div class="skc-box-thumbnail">
				<%= image_tag("lecture.png")  %>
			</div>
			<div class="skc-box-title">
				<a data-toggle="collapse" href="#collapseDescription">
	        <h4><%= @subject.name %></h4>
	      </a>
	    </div>
			<div class="skc-box-desc collapse in" id="collapseDescription">
				<p>
					<%= sanitize(@subject.description) %>
				</p>
				<hr />
				<p>
					<strong>推奨学期:</strong>
					<%= link_to "#{@subject.semester.uni_year.name}#{@subject.semester.name}", course_subjects_path(@subject.course, filter: '学年別', semester: @subject.semester.id) %>
				</p>
				<p>
					<strong>時間:</strong>
					<% @subject.periods.each do |period| %>
						<% if period != @subject.periods.first %>
						・
						<% end %>
						<%= Period.time_names(period.time) %><%= Period.day_names(period.day) %>
					<% end %>
				</p>
				<p>
					<strong>講義室:</strong>
					<%= @subject.place %>
				</p>
				<p>
					<strong>教員:</strong>
					<% @subject.teachers.each do |teacher| %>
	      		<% if teacher != @subject.teachers.first  %>
	      		・
	      		<% end %>
						<%= link_to teacher.name_kanji, teacher %>
    			<% end %>
				</p>
			</div>
			
			<% if user_signed_in? %>
			<div class="skc-box-menu">
				<%= link_to edit_subject_path(@subject.id) do %>
					<span class="glyphicon glyphicon-pencil"></span>
				<% end %>
				<%= link_to @subject, method: :delete, data: { confirm: 'Are you sure?' } do %>
					<span class="glyphicon glyphicon-remove"></span>
				<% end %>
			</div>
			<% end %>
		</div>
	</div><!--end of skc-box-->
	
  <!--for overview section -->
 	<a name="syllabus"></a>
	<div class="skc-box skc-box-no-padding skc-box-lg">
		<div class="skc-box-content">
			<div class="skc-box-title-no-margin">
				<a data-toggle="collapse" href="#collapseSyllabus">
	        <h4>シラバス</h4>
	      </a>
	    </div>
			<div class="skc-box-desc skc-box-desc-no-margin collapse out" id="collapseSyllabus">
				<table class="table table-bordered table-hover">
			    <thead>
			      <tr>
			        <th class="col-xs-2 col-sm-1">回数</th>
			        <th class="col-xs-3 col-sm-3">日付</th>
			        <th class="col-xs-7 col-sm-9">内容</th>
			      </tr>
			    </thead>
			    <tbody>
			    	<% @subject.outlines.order('number ASC').each do | outline | %>
			      <tr>
			        <td><%= link_to "#{outline.number}", subject_path(tag: "#{outline.number}回目"), class: 'outline-btn' %></td>
			        <td><a href="#" data-type="date" data-viewformat="yyyy-mm-dd" data-pk="<%= outline.number %>" class="outline-date"><%= outline.date %></a></td>
			        <td><a href="#" data-pk="<%= outline.number %>" class="outline-content"><%= sanitize(outline.content) %></a></td>
			      </tr>
			      <% end %>
			    </tbody>
			  </table>
			</div>
		</div>
	</div>
	
	
	<!--for overview section -->
 	<a name="notes"></a>
	<div class="skc-box skc-box-no-padding skc-box-lg">
		<div class="skc-box-content">
			<div class="skc-box-title-no-margin">
				<a data-toggle="collapse" href="#collapseNotes">
	        <h4>ノート</h4>
	      </a>
	    </div>
			<div class="skc-box-desc skc-box-desc-no-margin collapse in" id="collapseNotes">
				<%= render @notes %>
			</div>
		</div>
	</div>
	
	<h4>関連授業:</h4>
	<div class="has-margin-lg">
		<div class="owl-carousel text-center">
	  	<%= render collection: @recommend_subjects, partial: 'subject_xs', as: :subject %>
		</div>
	</div>
	
</div>
<script>
	//turn to inline mode
	$.fn.editable.defaults.mode = 'inline';
	$.fn.editable.defaults.ajaxOptions = {dataType: 'json', type: "PUT"};
	$(document).ready(function() {			
			$('.outline-date').editable({
			    format: 'yyyy-mm-dd', //for sending value
			    name: 'date',
			    url: '/subjects/<%= @subject.id %>/inline',
          showbuttons: 'bottom'
			});
			
			$('.outline-content').editable({
			    type: 'textarea',
			    name: 'content',
			    url: '/subjects/<%= @subject.id %>/inline',
          showbuttons: 'bottom'
			});
	});
		/*For schedule add btn in show subject page*/
		/*Need selector on a to ensure binding on dynamically elements */
	$("#show-subject-schedule").on("click", "a", function() {
		$.ajax({
			url: this.href,
			type: this.getAttribute("data-method"),
			dataType: "script",
			success: function() {
				$.getScript("/subjects/<%= @subject.id %>", null);
				//need to get script in order to refresh menu
			}
		});
		return false;
	});
	
	$(".owl-carousel").owlCarousel({
		items : 4,
    itemsDesktop : [1199,3],
    itemsDesktopSmall : [980,2],
    itemsTablet: [768,2],
    itemsTabletSmall: false,
    itemsMobile : [479,1],
		navigation:true,
    navigationText: [
      "<span class='glyphicon glyphicon-chevron-left'></span>",
      "<span class='glyphicon glyphicon-chevron-right'></span>"
      ],
	});

</script>